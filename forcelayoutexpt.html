<!DOCTYPE html>
<html>
<head>
    <title>Force-Directed Layout (Dynamic)</title>
    <script src="http://d3js.org/d3.v3.js"></script>
    <style type="text/css">

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        rect {
            fill: #fff;
        }

        .node {
            fill: #000;
        }

        .cursor {
            fill: none;
            stroke: brown;
            pointer-events: none;
        }
        .link {
            stroke: orange;
        }

    </style>
</head>
<body>
<div id="DustMagnets"></div>
<script type="text/javascript">
    var BasinArraySet = [
        {id: 5,pH: 5,sol: 15, amm: 3, per: 3.2, toc: 2.01},
        {id: 6,pH: 9.5,sol: 3, amm: 5.3, per: 21, toc: 0.23}
    ];
    var width = 960, height = 500, magnetRadius = 20;

    var keys = [
        {name: 'pH'},
        {name: 'sol'},
        {name: 'amm'},
        {name: 'per'},
        {name: 'toc'}
    ];

    var drag = d3.behavior.drag()
            .on('drag',dragmove)
            .on('dragend',updateDust);
    
    function dragmove(d) {

        console.log(d);
        
        d3.select(this)
                .attr('cx',d.x = Math.max(magnetRadius,Math.min(width - magnetRadius,d3.event.x)))
                .attr('cy',d.y = Math.max(magnetRadius,Math.min(height - magnetRadius,d3.event.y)));
    }

    function updateDust() {
        d3.selectAll('.dust-circle')
                .transition()
                .duration(500)
                .ease('bounce')
                .attr('cx',function (d) {
                    var x = d.x;
                    keys.forEach(function (key) {
                        var val = key.name;
                        var dustVal = d[val];
                        var DiffX = key.x - x;
                        var scale = d3.scale.linear().domain([key.min,key.max]).range([0.1,0.9]);
                        var ChangeVar = scale(dustVal);
                        x+=DiffX*ChangeVar;
                    });
                    return x;
                })
                .attr('cy',function (d) {
                    var y = d.y;
                    keys.forEach(function (key) {
                        var val = key.name;
                        var dustVal = d[val];
                        var DiffX = key.y - y;
                        var scale = d3.scale.linear().domain([key.min,key.max]).range([0.1,0.9]);
                        var ChangeVar = scale(dustVal);
                        y+=DiffX*ChangeVar;
                    });
                    return y;
                });
    }

    var activeMagnets = [];

    keys.forEach(function (d) {
        d.min = d3.min(BasinArraySet,function (de) {
            return de[d.name];
        });
        d.max = d3.max(BasinArraySet,function (de) {
            return de[d.name];
        });
        d.active = true;
        d.fill = 'black'
    });

    var svg = d3.select('#DustMagnets').append('svg')
            .attr('width',width)
            .attr('height',height)
            .attr('style','padding: 10px 10px');

    var magnets = svg.selectAll('.magnet-group')
            .data(keys)
            .enter()
            .append('g')
            .attr('class','magnet-group');

    magnets.append('circle')
            .attr('class','magnet-circle')
            .attr('r',magnetRadius)
            .attr('cx',function (d) {
                d.x = 0;
                return d.x;
            })
            .attr('cy',function (d) {
                d.y = 0;
                return d.y
            })
            .call(drag);

    var dust = svg.selectAll('.dust-group')
            .data(BasinArraySet)
            .enter()
            .append('g')
            .attr('class','dust-group');

    dust.append('circle')
            .attr('class','dust-circle')
            .attr('r',5)
            .attr('cx',function (d) {
                d.x = 0;
                return d.x;
            })
            .attr('cy',function (d) {
                d.y = 0;
                return d.y;
            })
            .attr('fill','blue');
</script>
</body>
</html>